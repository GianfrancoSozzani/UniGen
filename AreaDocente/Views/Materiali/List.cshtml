@model List<AreaDocente.Models.Entities.MVCMateriali>

@functions {
    string GetIconClass(string contentType)
    {
        return contentType switch
        {
            "application/pdf" => "bi-file-earmark-pdf-fill text-danger",
            "application/msword" or "application/vnd.openxmlformats-officedocument.wordprocessingml.document" => "bi-file-earmark-word-fill text-primary",
            "application/vnd.ms-excel" or "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" => "bi-file-earmark-excel-fill text-success",
            "image/jpeg" or "image/png" => "bi-file-earmark-image-fill text-info",
            _ => "bi-file-earmark-fill"
        };
    }

    bool IsViewableInBrowser(string contentType)
    {
        return contentType switch
        {
            "application/pdf" => true,
            "image/jpeg" => true,
            "image/png" => true,
            _ => false
        };
    }
}

<div class="container my-5">
    <h1>Elenco Materiali</h1>

    <table class="table">
        <thead>
            <tr>
                <th>Titolo</th>
                <th>Materiale</th>
                <th>Esame</th>
                <th>Azioni</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var mat in Model)
            {
                var iconClass = GetIconClass(mat.Tipo);

                <tr>
                    <td>@mat.Titolo</td>
                    <td>
                        <div class="d-flex justify-content-start gap-2" style="min-width: 180px;">
                            @if (IsViewableInBrowser(mat.Tipo))
                            {
                                <a asp-action="View" target="_blank" asp-route-id="@mat.K_Materiale" class="btn btn-outline-primary btn-sm" style="min-width: 99.25px">
                                    <i class="bi @iconClass me-1"></i> Visualizza
                                </a>
                            }
                            else
                            {
                                <span style="width: 99.25px;"></span> @* Segnaposto per allineamento Visualizza *@
                            }

                            <a asp-action="Download" asp-route-id="@mat.K_Materiale" class="btn btn-secondary btn-sm">
                                <i class="bi bi-download me-1"></i> Scarica
                            </a>
                        </div>
                    </td>




                    <td>@mat.esame?.TitoloEsame</td>
                    <td>
                        <a class="btn btn-primary btn-sm" asp-controller="Materiali" asp-action="Edit" asp-route-id="@mat.K_Materiale">
                            <i class="bi bi-pencil-square me-1"></i> Modifica
                        </a>
                    </td>
                </tr>
            }
        </tbody>
        <tfoot>
            <tr>
                <td colspan="4">
                    <a class="btn btn-success" asp-controller="Materiali" asp-action="Add">
                        <i class="bi bi-plus-circle me-1"></i> Inserisci nuovo materiale
                    </a>
                </td>
            </tr>
        </tfoot>
    </table>
</div>
